.. _datashare:

************************
交我算账号的数据共享
************************

数据共享需求
===================

交我算的主帐号和子帐号都为独立帐号，仅在计费关系上存在关联。若有数据共享需求，可由主帐号负责人发邮件给我们。

注意：
π2.0/AI/ARM集群及思源一号集群使用两个独立的存储系统，因此共享文件夹需要分开申请。

数据共享场景
======================

目前数据共享场景包括：主账号和子账号的共享、不同主账号之间的共享、校外数据共享。

**主账号和子账号的共享**

在主账号下建立 ``acct-XXX/share`` 文件夹，主帐号和子帐号均可在此文件夹下读写。

**不同主账号之间的共享**

在一个主账号下建立 ``acct-XXX/share`` 文件夹，共享数据的存储费会计入该账号。另外为其他主账号开放共享文件夹的读权限。

**校外数据共享**

1.用户登录

科学数据平台使用jAccount进行登录认证，在首页找到“login”按钮后，点击跳转至jAccount认证界面。使用账号密码认证通过后，自动跳转至网站首页。
首次登录前，需要在“交我办”中，找到“交我算”-“数据发布”-“科学数据平台账号激活申请”，申请账号激活。

.. image:: ./img/scidata_login.png

2.发布数据


**创建一条记录并添加数据文件**

点击右上角“+”号，在下拉选项中选择“upload”即可进入数据发布页面。
数据文件可以通过浏览器拖拽或点选文件上传，如果没有数据文件，仅有元数据信息，则勾选“Metadata-only record”。

.. image:: ./img/scidata_upload.png

3.数据分享

每个数据都有专属的展示页面，详情页的右侧有生成链接按钮，点击后可以生成访问链接。校外用户直接点击，即可进入数据详情页下载数据。

其他问题
===================

1. 用户可以自行添加共享文件夹的权限吗？

可以，在申请建立共享文件夹之后，主账号负责人可以自行添加共享文件夹的权限，将数据共享给其他账号。具体可参考以下命令。

.. warning::

    添加数据共享权限时，请注意数据安全，谨慎添加权限。

.. code:: bash

    # 假设主账号用户expuser01在思源一号个人目录/dssg/home/acct-exp/expuser01，共享文件夹路径为/dssg/home/acct-exp/share
    # 查看共享文件夹的ACL权限，rwx代表读写权限，r-x代表只读权限
    getfacl /dssg/home/acct-exp/share

    # 添加子账号expuser02的只读权限
    setfacl -m u:expuser02:r-x /dssg/home/acct-exp/share

    # 添加子账号expuser03的读写权限
    setfacl -m u:expuser03:rwx /dssg/home/acct-exp/share

2. 如何将共享文件夹中的文件设置成只读？

假设某个账号需要共享一个文件，并且希望这个文件别人无法修改，这时可以将文件权限修改为744，只让文件的所有者能修改，其他人为只读。

.. code:: bash

    # 假设主账号用户expuser01在思源一号个人目录/dssg/home/acct-exp/expuser01，共享文件夹路径为/dssg/home/acct-exp/share，需要共享的文件名为file
    # 查看文件的权限，第三列的用户名代表所有者
    ls -l /dssg/home/acct-exp/share/file
    # 修改文件的权限为644（rw-r--r--），让其他用户只能读
    chmod 644 /dssg/home/acct-exp/share/file
