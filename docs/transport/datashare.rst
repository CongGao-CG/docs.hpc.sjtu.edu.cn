.. _datashare:

************************
交我算账号的数据共享
************************

数据共享需求
===================

交我算的主帐号和子帐号都为独立帐号，仅在计费关系上存在关联。若有数据共享需求，可由主帐号负责人发邮件给我们。

注意：
π2.0/AI/ARM集群及思源一号集群使用两个独立的存储系统，因此共享文件夹需要分开申请。

数据共享场景
======================

目前数据共享场景包括：主账号和子账号的共享、不同主账号之间的共享、校外数据共享。

我要读取子账号数据
----------------------

在主账号下建立 ``acct-XXX/share`` 文件夹，主帐号和子帐号均可在此文件夹下读写。

我要修改子账号数据
--------------------

我要在账户内创建可读写的公共空间
---------------------------------

在一个主账号下建立 ``acct-XXX/share`` 文件夹，共享数据的存储费会计入该账号。另外为其他主账号开放共享文件夹的读权限。

我要读取主账号数据
-------------------

我要共享数据到集群外
------------------------

将“交我算”账号的数据共享给非超算用户，可以使用https://scidata.sjtu.edu.cn/提供的服务。通过可视化平台在超算上打开平台网站，上传数据后分享链接至他人。具体操作步骤可以查看文档：

* :ref:`scidatausage`

其他问题
===================

1. 用户可以自行添加共享文件夹的权限吗？

可以，在申请建立共享文件夹之后，主账号负责人可以自行添加共享文件夹的权限，将数据共享给其他账号。具体可参考以下命令。

.. warning::

    添加数据共享权限时，请注意数据安全，谨慎添加权限。

.. code:: bash

    # 假设主账号用户expuser01在思源一号个人目录/dssg/home/acct-exp/expuser01，共享文件夹路径为/dssg/home/acct-exp/share
    # 查看共享文件夹的ACL权限，rwx代表读写权限，r-x代表只读权限
    getfacl /dssg/home/acct-exp/share

    # 添加子账号expuser02的只读权限
    setfacl -m u:expuser02:r-x /dssg/home/acct-exp/share

    # 添加子账号expuser03的读写权限
    setfacl -m u:expuser03:rwx /dssg/home/acct-exp/share

2. 如何将共享文件夹中的文件设置成只读？

假设某个账号需要共享一个文件，并且希望这个文件别人无法修改，这时可以将文件权限修改为744，只让文件的所有者能修改，其他人为只读。

.. code:: bash

    # 假设主账号用户expuser01在思源一号个人目录/dssg/home/acct-exp/expuser01，共享文件夹路径为/dssg/home/acct-exp/share，需要共享的文件名为file
    # 查看文件的权限，第三列的用户名代表所有者
    ls -l /dssg/home/acct-exp/share/file
    # 修改文件的权限为644（rw-r--r--），让其他用户只能读
    chmod 644 /dssg/home/acct-exp/share/file
